#' Flag Duplicated Records
#' 
#' Flags duplicated records based on species name and coordinates, as well as
#' user-defined additional columns. True (specimen) duplicates or duplicates
#' from the same species can make up the bulk of records in a biological
#' collection database, but are undesirable for many analyses. Both can be
#' flagged with this function, the former given enough additional information.
#' 
#' 
#' @param x a data.frame. Containing geographical coordinates and species
#' names.
#' @param lon a character string. The column with the longitude coordinates.
#' Default = \dQuote{decimallongitude}.
#' @param lat a character string. The column with the longitude coordinates.
#' Default = \dQuote{decimallatitude}.
#' @param species a character string. The column with the species name. Default
#' = \dQuote{species}.
#' @param additions a vector of character strings. Additional columns to be
#' included in the test for duplication. For example as below, collector name
#' and collector number.
#' @param value a character string.  Defining the output value. See value.
#' @param verbose logical. If TRUE reports the name of the test and the number
#' of records flagged
#' @return Depending on the \sQuote{value} argument, either a \code{data.frame}
#' containing the records considered correct by the test (\dQuote{clean}) or a
#' logical vector, with TRUE = test passed and FALSE = test failed/potentially
#' problematic (\dQuote{flags}). Default = \dQuote{clean}.
#' @note See \url{https://github.com/azizka/CoordinateCleaner/wiki} for more
#' details and tutorials.
#' @keywords Coordinate cleaning
#' @examples
#' 
#' x <- data.frame(species = letters[1:10], 
#'                 decimallongitude = sample(x = 0:10, size = 100, replace = TRUE), 
#'                 decimallatitude = sample(x = 0:10, size = 100, replace = TRUE),
#'                 collector = "Bonpl",
#'                 collector.number = c(1001, 354),
#'                 collection = rep(c("K", "WAG","FR", "P", "S"), 20))
#' 
#' cc_dupl(x, value = "flags")
#' cc_dupl(x, additions = c("collector", "collector.number"))
#' 
#' @export
cc_dupl <- function(x, 
                    lon = "decimallongitude", 
                    lat = "decimallatitude", 
                    species = "species",
                    additions = NULL, 
                    value = "clean", 
                    verbose = TRUE) {

  # check value argument
  match.arg(value, choices = c("clean", "flags"))

  if (verbose) {
    message("Testing duplicates")
  }
  # test duplication
  out <- !duplicated(x[, c(lon, lat, species, additions)])

  # create output based on value argument
  if (verbose) {
    message(sprintf("Flagged %s records.", sum(!out)))
  }

  switch(value, clean = return(x[out, ]), flags = return(out))
}
